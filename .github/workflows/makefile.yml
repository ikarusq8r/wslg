name: WSLGd Build CI

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build-wslgd:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4

    - name: Install build dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y clang libcap-dev

    - name: Build WSLGd
      run: |
        cd WSLGd
        make

    - name: Check WSLGd binary exists
      run: |
        test -f WSLGd/WSLGd
        echo "âœ“ WSLGd built successfully"

  build-rdpapplist:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4

    - name: Install meson and dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y meson pkg-config libfreerdp-dev libwinpr-dev

    - name: Configure rdpapplist
      run: |
        cd rdpapplist
        meson setup build

    - name: Build rdpapplist
      run: |
        cd rdpapplist
        meson compile -C build

    - name: Test rdpapplist
      run: |
        cd rdpapplist
        meson test -C build || true
